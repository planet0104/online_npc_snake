# 单人贪吃蛇游戏逻辑

```
1、主逻辑更新速度每秒6次
   a.移动蛇
   b.移动蛇后吃食物
   c.吃到食物后长大
   d.检测游戏是否结束(碰撞)

2、食物逻辑每秒更新一次
   a.生成一个新的食物

3、主要事件及后续操作
   a.GameOverEvent 游戏结束：删除所有实体、创建一个小蛇
   b.GrowthEvent 蛇长大：增加一段蛇身
   c.蛇吃到食物：删除食物实体、发送GrowthEvent
   d.移动蛇：根据蛇头方向向前移动一格、检测碰撞并发送GameOverEvent
   e.键盘输入：调整蛇头方向
   
```

# 多人贪吃蛇的游戏逻辑

## 游戏本身逻辑

```
1、主逻辑更新速度每秒6次
   a.移动所有蛇
   b.判断所有蛇，是否吃到食物
   c.吃到食物后长大
   d.检测每个蛇是否碰到了其他蛇或者障碍物，碰到以后，这个蛇死亡

2、食物逻辑每秒更新一次
   a.生成N个新的食物

3、主要事件及后续操作
   a.SnakeDeathEvent 蛇(玩家)死亡：删除蛇
   b.SnakeGrowthEvent 蛇(玩家)长大：这条蛇增加一段蛇身
   c.蛇吃到食物：删除食物实体、发送SnakeGrowthEvent
   d.移动蛇：根据蛇头方向向前移动一格、检测碰撞并发送GameOverEvent
   e.玩家键盘输入：调整玩家蛇头方向
```

## 服务器端

```
1、更新游戏主逻辑
   a. 移动、碰撞检测、生成食物
   b. 玩家加入游戏 -> 添加玩家 -> 添加蛇实体
   c. 玩家掉线 -> 删除玩家 -> 蛇实体将失控

3、下发同步数据
   a. 玩家连线 -> 回复玩家ID
   b. 玩家加入游戏 -> 下发所有玩家列表
   c. 玩家蛇死亡 -> 通知所有客户端玩家死亡
   d. SyncData -> 每个更新周期同步玩家和蛇实体的得分/生命/蛇头位置

2、处理玩家上传过来的数据
   a. KeyEvent 键盘操作 -> 移动该玩家的蛇头方向
   b. OnConnect 客户端连线
   c. OnDisconnect 玩家掉线
   d. StartGame 玩家加入游戏
   e. SyncData 单个玩家发过来的同步数据
```

## 客户端

```
1、更新游戏主逻辑

2、上传玩家数据
    a. SyncData -> 蛇头位置
    b. KeyEvent
    c. StartGame -> 加入游戏/重新加入游戏

3、接收服务器端下发的每个消息
    a. OnConnect -> 接收玩家ID
    b. Players -> 服务器发送来的玩家列表
    c. SyncData -> 同步所有玩家和蛇实体的得分/生命/蛇头位置
    d. 玩家死亡 -> 删除玩家的蛇实体

4、本地游戏逻辑
    上/下/左/右按下 -> 移动玩家方向
    绘制游戏
    绘制玩家列表和排名
    绘制死亡弹窗
```

## NPC（非玩家角色）逻辑

```
1、训练NPC大脑(遗传算法+神经网络)
   a. 使用neat-gru库，基于NEAT(增强拓扑的进化神经网络)算法
   b. 输入神经元：共6个，[0,0,0,0,0,0] 6个触角分别检测前方敌人/障碍物
   c. 输出神经元：共4个，[0,0,0,0] 分别控制上,下,左,右 0代表无效 1代表有效

2、演化后的模型放到服务器端推理，然后作用到每个NPC
   a. 随机初始化N个NPC演化
   b. 挑选出最优的作为模型
```