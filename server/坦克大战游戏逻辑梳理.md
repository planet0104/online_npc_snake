# 服务器端

## 服务器以50帧的速度更新游戏逻辑

```

操作1：从网络消息队列中获取一个客户端发来的消息
    
    玩家进入游戏websocket链接 -> 向服务器发送 MSG_CONNECT -> 给玩家单独发送服务器ip信息
    玩家点击加入游戏按钮 -> 向服务器发送 MSG_START(username) -> 服务器1.添加玩家精灵 2.下发玩家列表
    服务器检测到玩家断开链接 -> 删除玩家和精灵
    玩家按键 -> 向服务器发送 MSG_KEY_EVENT(playerid,key) -> 服务器根据按键更新游戏
    玩家客户端上传数据 -> 向服务器发送 MSG_SYNC_DATA(位置/速度) ->  服务器更新玩家精灵的位置/速度

操作2：游戏update

操作3：打包下发给客户端的消息

    SERVER_MSG_EVENT -> 包含玩家死亡、玩家加入等
    SERVER_MSG_SYNC -> 所有玩家的得分/生命/精灵位置/精灵速度

```


# 客户端

## 客户端以60帧速度运行


```
操作1：每秒同步5次玩家数据到到服务器端
    MSG_SYNC_DATA -> 位置/动画/速度
    MSG_KEY_EVENT -> 按键事件
    MSG_START -> 加入游戏/重新加入游戏
    MSG_CONNECT -> 连接网络

操作2：接收服务器端下发的每个消息
    SERVER_MSG_ERR -> 服务器错误
    SERVER_MSG_IP -> 服务器发送过来的ip 收到以后发送 MSG_START
    SERVER_MSG_PLAYERS -> 服务器发送来的玩家列表
    SERVER_MSG_SYNC -> 服务器返回的精灵数据，用来更新客户端的精灵速度/创建精灵/得分排序
    SERVER_MSG_EVENT -> 玩家死亡/玩家上线

操作3：处理键盘事件
    上/下/左/右按下 ->移动玩家方向，设置玩家速度
    按键弹起 -> 玩家速度停止
    键盘事件放入数组中，等待发送给服务器

操作4：更新游戏

操作5：绘制游戏
    绘制游戏精灵
    绘制玩家列表和排名
    绘制死亡倒计时




    
```


